# KV Manager - Production Configuration Template
# Copy this file to wrangler.toml and fill in your values

name = "kv-manager"
main = "worker/index.ts"
compatibility_date = "2025-01-01"
node_compat = true

# Uncomment and configure for custom domain
# routes = [
#   { pattern = "kv.yourdomain.com", custom_domain = true }
# ]

# Or use workers.dev subdomain (default)
# Your Worker will be available at: https://kv-manager.your-account.workers.dev

# Build configuration
[build]
command = "npm run build"
cwd = "./"
watch_dirs = ["src", "worker"]

# Build output
[site]
bucket = "./dist"

# D1 Metadata Database
# Create with: npx wrangler d1 create kv-manager-metadata
# Initialize with: npx wrangler d1 execute kv-manager-metadata --remote --file=worker/schema.sql
[[d1_databases]]
binding = "METADATA_DB"
database_name = "kv-manager-metadata"
database_id = "YOUR_D1_DATABASE_ID"  # Get from d1 create command

# Durable Objects for bulk operations
[[durable_objects.bindings]]
name = "BULK_OPERATION_DO"
class_name = "BulkOperationDO"
script_name = "kv-manager"

[[durable_objects.bindings]]
name = "IMPORT_EXPORT_DO"
class_name = "ImportExportDO"
script_name = "kv-manager"

# Durable Object migrations
[[migrations]]
tag = "v1"
new_classes = ["BulkOperationDO", "ImportExportDO"]

# Environment variables (non-sensitive)
[vars]
ENVIRONMENT = "production"

# Secrets (set with: npx wrangler secret put SECRET_NAME)
# Required secrets:
# - ACCOUNT_ID: Your Cloudflare account ID
# - API_KEY: Cloudflare API token with Account D1 Edit and Workers KV Storage Edit permissions
# - TEAM_DOMAIN: Your Cloudflare Access team domain (e.g., https://yourteam.cloudflareaccess.com)
# - POLICY_AUD: Application Audience (AUD) tag from Cloudflare Access application

# Set secrets with:
# npx wrangler secret put ACCOUNT_ID
# npx wrangler secret put API_KEY
# npx wrangler secret put TEAM_DOMAIN
# npx wrangler secret put POLICY_AUD

